<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# auth\_app

```go
import "pim-sys/internal/auth/app"
```

## Index

- [type App](<#App>)
  - [func New\(log \*slog.Logger, grpcPort int, connectionString string, tokenTTL time.Duration\) \*App](<#New>)
- [type Auth](<#Auth>)
  - [func \(a \*Auth\) IsAdmin\(ctx context.Context, userID int64\) \(bool, error\)](<#Auth.IsAdmin>)
  - [func \(a \*Auth\) Login\(ctx context.Context, email string, password string\) \(string, error\)](<#Auth.Login>)
  - [func \(a \*Auth\) RegisterNewUser\(ctx context.Context, email string, pass string, name string, phone string\) \(int64, error\)](<#Auth.RegisterNewUser>)
- [type UserProvider](<#UserProvider>)
- [type UserSaver](<#UserSaver>)


<a name="App"></a>
## type App



```go
type App struct {
    GRPCServer *grpcapp.App
}
```

<a name="New"></a>
### func New

```go
func New(log *slog.Logger, grpcPort int, connectionString string, tokenTTL time.Duration) *App
```



<a name="Auth"></a>
## type Auth



```go
type Auth struct {
    // contains filtered or unexported fields
}
```

<a name="Auth.IsAdmin"></a>
### func \(\*Auth\) IsAdmin

```go
func (a *Auth) IsAdmin(ctx context.Context, userID int64) (bool, error)
```

IsAdmin checks if user is admin.

<a name="Auth.Login"></a>
### func \(\*Auth\) Login

```go
func (a *Auth) Login(ctx context.Context, email string, password string) (string, error)
```

Login checks if user with given credentials exists in the system and returns access token.

If user exists, but password is incorrect, returns error. If user doesn't exist, returns error.

<a name="Auth.RegisterNewUser"></a>
### func \(\*Auth\) RegisterNewUser

```go
func (a *Auth) RegisterNewUser(ctx context.Context, email string, pass string, name string, phone string) (int64, error)
```

RegisterNewUser registers new user in the system and returns user ID. If user with given username already exists, returns error.

<a name="UserProvider"></a>
## type UserProvider



```go
type UserProvider interface {
    User(ctx context.Context, email string) (storage.User, error)
    IsAdmin(ctx context.Context, userID int64) (bool, error)
}
```

<a name="UserSaver"></a>
## type UserSaver



```go
type UserSaver interface {
    SaveUser(
        ctx context.Context,
        email string,
        passHash []byte,
        name string,
        phone string,
    ) (uid int64, err error)
}
```

# auth\_errors

```go
import "pim-sys/internal/auth/errors"
```

## Index

- [Variables](<#variables>)


## Variables

<a name="ErrUserExists"></a>

```go
var (
    ErrUserExists         = errors.New("user already exists")
    ErrUserNotFound       = errors.New("user not found")
    ErrAppNotFound        = errors.New("app not found")
    ErrInvalidCredentials = errors.New("invalid credentials")
)
```

# auth\_jwt

```go
import "pim-sys/internal/auth/jwt"
```

## Index

- [func NewToken\(user storage.User, duration time.Duration\) \(string, error\)](<#NewToken>)


<a name="NewToken"></a>
## func NewToken

```go
func NewToken(user storage.User, duration time.Duration) (string, error)
```

NewToken creates new JWT token for given user and app.

# secret

```go
import "pim-sys/internal/auth/secret"
```

## Index

- [Constants](<#constants>)


## Constants

<a name="Secret"></a>

```go
const Secret = "test-secret"
```

# auth\_service

```go
import "pim-sys/internal/auth/service"
```

## Index

- [Constants](<#constants>)
- [func Register\(gRPCServer \*grpc.Server, auth Auth\)](<#Register>)
- [type Auth](<#Auth>)


## Constants

<a name="LoginOrEmailRegex"></a>

```go
const (
    LoginOrEmailRegex = `^(?:[a-zA-Z0-9]+|[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,})$`
    PasswordRegex     = `^[a-zA-Z!_?$#@]{8,}$`
    PhoneRegex        = `^((8|\+7)[\- ]?)?(\(?\d{3}\)?[\- ]?)?[\d\- ]{7,10}$`
)
```

<a name="Register"></a>
## func Register

```go
func Register(gRPCServer *grpc.Server, auth Auth)
```



<a name="Auth"></a>
## type Auth



```go
type Auth interface {
    Login(
        ctx context.Context,
        email string,
        password string,
    ) (token string, err error)
    RegisterNewUser(
        ctx context.Context,
        email string,
        password string,
        name string,
        phone string,
    ) (userID int64, err error)
    IsAdmin(ctx context.Context, userID int64) (bool, error)
}
```

# storage

```go
import "pim-sys/internal/auth/storage"
```

## Index

- [type Storage](<#Storage>)
  - [func New\(connectionString string\) \(\*Storage, error\)](<#New>)
  - [func \(s \*Storage\) IsAdmin\(ctx context.Context, userID int64\) \(bool, error\)](<#Storage.IsAdmin>)
  - [func \(s \*Storage\) SaveUser\(ctx context.Context, email string, passHash \[\]byte, name string, phone string\) \(int64, error\)](<#Storage.SaveUser>)
  - [func \(s \*Storage\) Stop\(\) error](<#Storage.Stop>)
  - [func \(s \*Storage\) User\(ctx context.Context, email string\) \(User, error\)](<#Storage.User>)
- [type User](<#User>)


<a name="Storage"></a>
## type Storage



```go
type Storage struct {
    // contains filtered or unexported fields
}
```

<a name="New"></a>
### func New

```go
func New(connectionString string) (*Storage, error)
```



<a name="Storage.IsAdmin"></a>
### func \(\*Storage\) IsAdmin

```go
func (s *Storage) IsAdmin(ctx context.Context, userID int64) (bool, error)
```

IsAdmin checks if the user is an admin.

<a name="Storage.SaveUser"></a>
### func \(\*Storage\) SaveUser

```go
func (s *Storage) SaveUser(ctx context.Context, email string, passHash []byte, name string, phone string) (int64, error)
```

SaveUser saves user to db.

<a name="Storage.Stop"></a>
### func \(\*Storage\) Stop

```go
func (s *Storage) Stop() error
```



<a name="Storage.User"></a>
### func \(\*Storage\) User

```go
func (s *Storage) User(ctx context.Context, email string) (User, error)
```

User returns user by email.

<a name="User"></a>
## type User



```go
type User struct {
    ID       int
    Name     string
    Email    string
    Phone    string
    PassHash []byte
    IsAdmin  bool
}
```

Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)
